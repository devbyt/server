SET autocommit=0;
CREATE TABLE t1 (a INT) ENGINE=InnoDB;
SHOW VARIABLES LIKE 'trx%idle_timeout';
Variable_name	Value
trx_changes_idle_timeout	0
trx_idle_timeout	0
trx_readonly_idle_timeout	0
SET trx_idle_timeout=1;
SHOW VARIABLES LIKE 'trx%idle_timeout';
Variable_name	Value
trx_changes_idle_timeout	0
trx_idle_timeout	1
trx_readonly_idle_timeout	0
BEGIN;
INSERT INTO t1 VALUES (1),(2),(3);
COMMIT;
SELECT * FROM t1;
a
1
2
3
BEGIN;
INSERT INTO t1 VALUES (4),(5),(6);
SELECT * FROM t1;
ERROR HY000: MySQL server has gone away
SELECT * FROM t1;
a
1
2
3
DROP TABLE t1;
SET trx_idle_timeout=0;
SHOW VARIABLES LIKE 'trx%idle_timeout';
Variable_name	Value
trx_changes_idle_timeout	0
trx_idle_timeout	0
trx_readonly_idle_timeout	0
SET autocommit=0;
CREATE TABLE t1 (a INT) ENGINE=InnoDB;
SHOW VARIABLES LIKE 'trx%idle_timeout';
Variable_name	Value
trx_changes_idle_timeout	0
trx_idle_timeout	0
trx_readonly_idle_timeout	0
SET trx_readonly_idle_timeout=1;
SHOW VARIABLES LIKE 'trx%idle_timeout';
Variable_name	Value
trx_changes_idle_timeout	0
trx_idle_timeout	0
trx_readonly_idle_timeout	1
BEGIN;
INSERT INTO t1 VALUES (1),(2),(3);
SELECT * FROM t1;
a
1
2
3
COMMIT;
SELECT * FROM t1;
a
1
2
3
SELECT * FROM t1;
ERROR HY000: MySQL server has gone away
SELECT * FROM t1;
a
1
2
3
DROP TABLE t1;
SET trx_readonly_idle_timeout=0;
SHOW VARIABLES LIKE 'trx%idle_timeout';
Variable_name	Value
trx_changes_idle_timeout	0
trx_idle_timeout	0
trx_readonly_idle_timeout	0
SET autocommit=0;
CREATE TABLE t1 (a INT) ENGINE=InnoDB;
SHOW VARIABLES LIKE 'trx%idle_timeout';
Variable_name	Value
trx_changes_idle_timeout	0
trx_idle_timeout	0
trx_readonly_idle_timeout	0
SET trx_changes_idle_timeout=1;
SHOW VARIABLES LIKE 'trx%idle_timeout';
Variable_name	Value
trx_changes_idle_timeout	1
trx_idle_timeout	0
trx_readonly_idle_timeout	0
BEGIN;
INSERT INTO t1 VALUES (1),(2),(3);
SELECT * FROM t1;
a
1
2
3
COMMIT;
SELECT * FROM t1;
a
1
2
3
SELECT * FROM t1;
a
1
2
3
INSERT INTO t1 VALUES (4),(5),(6);
SELECT * FROM t1;
ERROR HY000: MySQL server has gone away
DROP TABLE t1;
SET trx_changes_idle_timeout=0;
SHOW VARIABLES LIKE 'trx%idle_timeout';
Variable_name	Value
trx_changes_idle_timeout	0
trx_idle_timeout	0
trx_readonly_idle_timeout	0
